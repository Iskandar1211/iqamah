# Настройка уведомлений для намаза

## Обзор

Приложение Iqamah теперь поддерживает фоновые уведомления для намаза, которые работают даже когда приложение закрыто.

## Функции уведомлений

- **Уведомления за 10 минут до намаза** - предупреждают о приближающемся времени намаза
- **Уведомления точно в время намаза** - напоминают о начале времени намаза
- **Планирование на 7 дней вперед** - уведомления автоматически планируются на неделю
- **Работа в фоновом режиме** - уведомления приходят даже когда приложение закрыто

## Настройка

### 1. Разрешения

При первом запуске приложение запросит разрешения на отправку уведомлений. Необходимо разрешить:

- **iOS**: Разрешить уведомления в настройках приложения
- **Android**: Разрешить уведомления при запросе

### 2. Включение/выключение уведомлений

1. Откройте приложение
2. Перейдите в **Настройки** (вкладка Settings)
3. Найдите секцию **Уведомления**
4. Включите/выключите переключатель **Уведомления о намазе**

### 3. Тестирование уведомлений

В настройках есть кнопка **"Тестировать уведомления"** для проверки работы системы уведомлений.

## Технические детали

### Планирование уведомлений

Уведомления планируются автоматически при:
- Изменении города
- Изменении метода расчета
- Смене дня
- Включении/выключении уведомлений

### Типы уведомлений

1. **Предварительные уведомления** (за 10 минут):
   - Заголовок: "Время намаза"
   - Текст: "До [название намаза] осталось 10 минут"

2. **Уведомления в точное время**:
   - Заголовок: "Время намаза"
   - Текст: "Время [название намаза]"

### Поддерживаемые платформы

- ✅ iOS (требует разрешений)
- ✅ Android (требует разрешений)
- ❌ Web (не поддерживается)

## Устранение неполадок

### Уведомления не приходят

1. **Проверьте разрешения**:
   - iOS: Настройки → Iqamah → Уведомления
   - Android: Настройки → Приложения → Iqamah → Уведомления

2. **Проверьте настройки устройства**:
   - Не беспокоить режим
   - Энергосбережение
   - Автозапуск приложений

3. **Перезапустите приложение**:
   - Закройте приложение полностью
   - Откройте заново
   - Проверьте настройки уведомлений

### Тестовое уведомление не работает

1. Убедитесь, что уведомления включены в настройках
2. Проверьте разрешения на уведомления
3. Попробуйте перезапустить приложение

## Конфигурация

### app.json

```json
{
  "expo": {
    "plugins": [
      [
        "expo-notifications",
        {
          "icon": "./assets/images/icon.png",
          "color": "#ffffff"
        }
      ]
    ]
  }
}
```

### Звуковые файлы

Приложение использует стандартные звуки уведомлений системы. Для добавления собственных звуков уведомлений:
1. Поместите звуковой файл в `assets/sounds/`
2. Обновите конфигурацию в `app.json`, добавив `"sounds": ["./assets/sounds/your-sound.wav"]`
3. Пересоберите приложение

## Разработка

### Основные файлы

- `utils/notifications.ts` - основная логика уведомлений
- `hooks/usePrayerTimes.ts` - интеграция с временем намаза
- `screens/SettingsScreen.tsx` - настройки уведомлений

### Функции API

```typescript
// Запрос разрешений
requestNotificationPermissions(): Promise<boolean>

// Планирование уведомлений
schedulePrayerNotifications(prayerTimes: PrayerTime[]): Promise<void>

// Отмена всех уведомлений
cancelAllNotifications(): Promise<void>

// Тестовое уведомление
sendTestNotification(): Promise<void>
```

## Безопасность

- Уведомления содержат только время и название намаза
- Персональные данные не передаются в уведомлениях
- Все уведомления локальные (не требуют сервера) 