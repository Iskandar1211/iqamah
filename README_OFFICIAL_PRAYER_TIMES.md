# Интеграция с официальными временами намаза

## Обзор

Этот документ описывает интеграцию приложения Iqamah с официальными временами намаза от Исламского центра Республики Таджикистан.

## Архитектура

### Файлы

1. **`types/prayerTimes.ts`** - Типы данных для времени намаза
2. **`utils/tajikistanPrayerTimes.ts`** - Основная логика работы с официальными данными
3. **`utils/mockOfficialData.ts`** - Примерные данные для тестирования
4. **`utils/prayerTimes.ts`** - Обновленная логика с fallback на расчеты adhan

### Принцип работы

1. Приложение сначала пытается получить официальные данные от Исламского центра
2. Если официальные данные недоступны, используется fallback на расчеты библиотеки adhan
3. Все данные кэшируются для оптимизации производительности

## Настройка

### 1. Включение/отключение примерных данных

В файле `utils/tajikistanPrayerTimes.ts`:

```typescript
// Флаг для использования примерных данных (установите false для реального API)
const USE_MOCK_DATA = true;
```

### 2. Настройка API URL

В файле `utils/tajikistanPrayerTimes.ts`:

```typescript
// URL для получения официальных данных (замените на реальный URL)
const OFFICIAL_API_URL = 'https://api.islamic-center.tj/prayer-times';
```

## API Спецификация

### Запрос

```
GET /prayer-times?city={cityId}&year={year}&month={month}
```

### Параметры

- `cityId` - ID города из списка городов
- `year` - Год (например, 2024)
- `month` - Месяц (1-12)

### Ответ

```json
[
  {
    "date": "2024-12-01",
    "fajr": "05:45",
    "sunrise": "07:15",
    "dhuhr": "12:15",
    "asr": "15:00",
    "maghrib": "17:30",
    "isha": "19:00"
  }
]
```

## Интеграция с Исламским центром

### Шаги для интеграции

1. **Связаться с Исламским центром Республики Таджикистан**
   - Получить доступ к API
   - Обсудить формат данных
   - Согласовать лимиты запросов

2. **Обновить URL API**
   ```typescript
   const OFFICIAL_API_URL = 'https://api.islamic-center.tj/prayer-times';
   ```

3. **Отключить примерные данные**
   ```typescript
   const USE_MOCK_DATA = false;
   ```

4. **Протестировать интеграцию**
   - Проверить получение данных
   - Убедиться в корректности времени
   - Проверить fallback механизм

### Требования к API

- **Доступность**: 24/7
- **Формат времени**: HH:MM (24-часовой формат)
- **Часовой пояс**: Asia/Dushanbe
- **Кодировка**: UTF-8
- **Формат даты**: YYYY-MM-DD

## Кэширование

Данные кэшируются по ключу: `{cityId}-{year}-{month}`

### Управление кэшем

```typescript
import { clearPrayerTimesCache, getCacheSize } from './utils/tajikistanPrayerTimes';

// Очистить кэш
clearPrayerTimesCache();

// Получить размер кэша
const size = getCacheSize();
```

## Fallback механизм

Если официальные данные недоступны, приложение автоматически переключается на расчеты библиотеки adhan с методом MuslimWorldLeague.

### Логирование

```typescript
console.log('Using official prayer times from Islamic Center of Tajikistan');
console.log('Using adhan calculations as fallback');
```

## Тестирование

### Примерные данные

Файл `utils/mockOfficialData.ts` содержит примерные данные для Душанбе на декабрь 2024 года.

### Тестирование интеграции

1. Включите `USE_MOCK_DATA = true`
2. Запустите приложение
3. Проверьте, что отображаются примерные данные
4. Отключите `USE_MOCK_DATA = false`
5. Проверьте fallback на расчеты adhan

## Мониторинг

### Метрики для отслеживания

- Процент успешных запросов к API
- Время ответа API
- Количество fallback на adhan
- Размер кэша

### Логирование ошибок

```typescript
console.warn('Failed to fetch official prayer times:', error);
console.error('Error calculating prayer times:', error);
```

## Безопасность

### Рекомендации

1. Используйте HTTPS для API запросов
2. Добавьте аутентификацию при необходимости
3. Ограничьте частоту запросов
4. Валидируйте полученные данные

## Поддержка

### Контакты

- **Исламский центр Республики Таджикистан**
- **Email**: [email центра]
- **Телефон**: [телефон центра]

### Документация

- [Официальный сайт Исламского центра](https://islamic-center.tj)
- [API документация](https://api.islamic-center.tj/docs)

## Обновления

### Версия 1.0.0
- Базовая интеграция с официальным API
- Fallback на расчеты adhan
- Кэширование данных
- Примерные данные для тестирования

### Планы на будущее
- Поддержка push-уведомлений от центра
- Автоматическое обновление данных
- Офлайн режим с кэшированными данными
- Поддержка дополнительных городов 